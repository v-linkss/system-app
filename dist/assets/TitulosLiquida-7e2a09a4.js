import{A as T}from"./AppBar-caeecede.js";import{r as h,o as p,d as V,w as t,c as e,f as k,l,x as n,a4 as g,i as f,j as A,e as u,q as L,s as v,h as y}from"./index-bf573807.js";import{_ as I}from"./_plugin-vue_export-helper-c27b6911.js";import{V as d}from"./VCol-394eff1d.js";import{V as c}from"./VSheet-5e2af548.js";import{V as U}from"./VContainer-bdb2f7f7.js";import{V as w}from"./VCheckbox-0df5a6d0.js";import{V as P}from"./VRow-835fc559.js";import"./VAutocomplete-22e1fd5b.js";import"./VSpacer-441d260f.js";import"./layout-c76e1f01.js";const C=a=>(L("data-v-0d292282"),a=a(),v(),a),R={key:1},E=C(()=>y("h1",{class:"ml-10 mt-5",style:{color:"#777777"}},"Liquidar Titulo",-1)),N={data(){return{userData:{},dados:{},data_pagamento:null,loading:!0,imprimir:!1,valor:null,acao:"LIQUIDAR"}},methods:{returnToMainPage(){this.$router.push("/gestao-perimetros/index")},async updateLiquida(){try{const a={Authorization:`Bearer ${this.userData.token}`},o=JSON.parse(localStorage.getItem("user")),s={titulo_token:this.dados.token,dt_pagamento:this.data_pagamento,vlr_pago:this.valor,user_token:o.token,acao:this.acao},i=await u.post("http://45.55.192.246:3333/service/gerencia/gerarTitulos",s,{headers:a}),m=i.data[0].func_ger_titulos[0].titulo_token;if(this.imprimir===!0)try{const r={titulo_token:m},_=await u.post("http://45.55.192.246:3333/service/gerencia/imprimirRecibo",r,{headers:a});console.log(_),window.open().document.write(_.data[0].func_imprime_recibo_titulo)}catch(r){console.error("Erro ao executar a função de impressão:",r)}return this.$router.push("/gestao-perimetros/index"),i}catch(a){console.error("Erro na chamada de API:",a)}},async calcularValor(){try{const a=await this.valorCalcula();console.log(a)}catch(a){console.error("Erro ao calcular valor:",a)}},async valorCalcula(){try{const a={titulo_token:this.dados.token,data:this.data_pagamento};console.log(`############
`,a);const o={Authorization:`Bearer ${this.userData.token}`},s=await u.post("http://45.55.192.246:3333/service/gerencia/calcularAcrescimo",a,{headers:o}),i=s.data[0].func_calcula_acrescimo_titulo;return this.valor=parseFloat(this.dados.valor)+parseFloat(i),console.log(this.valor),s}catch(a){console.error("Erro na chamada de API:",a)}},async botao(){console.log(this.imprimir)},async loadLotes(){try{const a={Authorization:`Bearer ${this.userData.token}`},o=await u.get(`http://45.55.192.246:3333/service/gerencia/getPrediosTitulosById/${this.dados.documento}`,{headers:a});this.dados=o.data,console.log(this.dados)}catch(a){console.error("Erro na chamada de API:",a)}finally{this.loading=!1}}},created(){this.$route.query.documento?(this.dados.documento=this.$route.query.documento,this.loadLotes()):console.log("Erro em carregar dados")},mounted(){this.userData=JSON.parse(localStorage.getItem("user")),(async()=>await this.loadLotes())()}},b=Object.assign(N,{__name:"TitulosLiquida",setup(a){return(o,s)=>{const i=h("font-awesome-icon"),m=h("LoadingComponent");return o.loading?(p(),V(m,{key:0},{default:t(()=>[e(i,{icon:["fas","spinner"],spin:""})]),_:1})):(p(),k("div",R,[E,e(T),e(U,{class:"data-container mt-7 mb-8"},{default:t(()=>[e(d,null,{default:t(()=>[e(c,{class:"pa-2 ma-2"},{default:t(()=>[l(" Lote: "+n(o.dados.pi_lotes.numero)+" - "+n(o.dados.pi_lotes.nome),1)]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(c,{class:"pa-2 ma-2"},{default:t(()=>[l(" Título: "+n(o.dados.documento),1)]),_:1})]),_:1}),e(g,{width:"100%"}),e(d,null,{default:t(()=>[e(c,{class:"pa-2 ma-2"},{default:t(()=>[l(" Nosso Número: "+n(o.dados.nosso_numero),1)]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(c,{class:"pa-2 ma-2"},{default:t(()=>[l(" Valor:R$ "+n(o.dados.valor),1)]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(c,{class:"pa-2 ma-2"},{default:t(()=>[l("Vencimento: "+n(o.dados.dt_vencimento),1)]),_:1})]),_:1}),e(g,{width:"100%"}),e(d,null,{default:t(()=>[e(c,{class:"pa-2 ma-2"},{default:t(()=>[l(" Link do Boleto: "+n(o.dados.link_boleto),1)]),_:1})]),_:1})]),_:1}),e(P,{"no-gutters":"",class:"justify-center align-center"},{default:t(()=>[e(f,{style:{width:"10px","margin-left":"170px"},modelValue:o.data_pagamento,"onUpdate:modelValue":s[0]||(s[0]=r=>o.data_pagamento=r),type:"date",label:"Data de pagamento",onChange:o.calcularValor},null,8,["modelValue","onChange"]),e(f,{modelValue:o.valor,"onUpdate:modelValue":s[1]||(s[1]=r=>o.valor=r),class:"ml-5",label:"Valor"},null,8,["modelValue"]),e(w,{modelValue:o.imprimir,"onUpdate:modelValue":s[2]||(s[2]=r=>o.imprimir=r),class:"ml-5",label:"Imprimir recibo",onClick:o.botao},null,8,["modelValue","onClick"])]),_:1}),e(A,{class:"me-4",style:{"margin-left":"170px"},color:"red",onClick:o.returnToMainPage},{default:t(()=>[l(" Voltar ")]),_:1},8,["onClick"]),e(A,{class:"me-4",color:"green",onClick:o.updateLiquida},{default:t(()=>[l(" Salvar ")]),_:1},8,["onClick"])]))}}}),$=I(b,[["__scopeId","data-v-0d292282"]]),Q={__name:"TitulosLiquida",setup(a){return(o,s)=>(p(),V($))}};export{Q as default};
