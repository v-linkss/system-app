import{o as c,f as g,c as s,w as l,h as d,i as u,a0 as b,F as V,v as T,d as _,$ as I,n as U,a2 as w,a3 as A,e as p,q as R,s as C}from"./index-88a5129e.js";import{a as B,_ as P}from"./visualizar-491b4619.js";import{A as S}from"./AppBar-f0429b7c.js";import{_ as E}from"./_plugin-vue_export-helper-c27b6911.js";import{V as i}from"./VCol-888c2a5e.js";import{V as L}from"./VAutocomplete-6839ad36.js";import{V as k}from"./VRow-0c716acb.js";import"./VSpacer-49a1f52c.js";import"./layout-44c14d18.js";const y=a=>(R("data-v-b0267a58"),a=a(),C(),a),D=y(()=>d("img",{style:{width:"40px",height:"40px"},src:B,alt:"Visualizar"},null,-1)),N=y(()=>d("img",{style:{width:"40px",height:"40px"},src:P,alt:"novo"},null,-1)),O={style:{"overflow-x":"auto"}},H={components:{VDataTable:A},data(){return{userData:{},filteredReceita:[],selected:[],selectedItem:null,lotesChecked:[],lotes:{data_vencimento:null,valor:null,observacao:null},receitas:[],lotesCombo:[],boleto:[],testVal:[],searchQuery:"",itemsPerPage:[20],footerProps:[20],headers:[{title:"Data",value:"data",search:"",width:"20%"},{title:"Conta",value:"conta",search:"",width:"20%"},{title:"Valor",value:"valor",search:"",width:"20%"},{title:"Cobrar/Devolver",value:"cobrar",search:"",width:"20%"},{title:"Observação",value:"observacao",search:"",width:"20%"}]}},computed:{valorTotal(){return this.lotes.valor||0}},methods:{async gerarReceitas(a){try{const e={Authorization:`Bearer ${this.userData.token}`},o={lote_token:a},n=(await p.post("http://localhost:3333/service/gerencia/loteReceita",o,{headers:e})).data[0].func_json_receitas_lote;this.receitas=n,this.filteredReceita=this.receitas,console.log(this.receitas)}catch(e){console.error("Erro ao carregar receitas:",e)}},async gerarBoletos(){try{const a={Authorization:`Bearer ${this.userData.token}`},e=JSON.parse(localStorage.getItem("predio")),t=JSON.parse(localStorage.getItem("user")),o=this.selectedItem,r=this.selected.map(m=>({receita_token:this.receitas.find(h=>h.id===m).token})),n={observacao:this.lotes.observacao,valor:this.lotes.valor,data_vencimento:this.lotes.data_vencimento,lote_token:o,predio_token:e.predio_token,user_token:t.token,receitas:r};console.log(n);const f=(await p.post("http://localhost:3333/service/gerencia/geraBoletos",n,{headers:a})).data[0].func_gera_boleto_lote;if(console.log(`responseData
`,f),this.boleto=f,this.boleto[0].integra_banco===!0){const m={titulo_token:this.boleto[0].titulo_token},v=await p.post("http://localhost:3333/service/gerencia/integraBanco",m,{headers:a});console.log("################-integraBanco-################");const h=v.data[0].func_integra_banco;window.open(h[0].link_boleto,"_blank")}}catch(a){console.error("Erro ao carregar receitas:",a)}},async loadLotes(){const e={predio_token:JSON.parse(localStorage.getItem("predio")).predio_token};try{const t={Authorization:`Bearer ${this.userData.token}`},r=(await p.post("http://localhost:3333/service/gerencia/lotesPredios",e,{headers:t})).data[0].func_json_lotes_predio;this.lotesCombo=r}catch(t){console.error("Erro ao carregar áreas:",t)}},saveSearchQuery(){localStorage.setItem("searchQuery",this.searchQuery);const a=localStorage.getItem("searchQuery");console.log("saveSearchQuery:",a)},sumCheckedValues(){const a=this.receitas.filter(t=>this.selected.includes(t.id));let e=0;a.forEach(t=>{if(console.log("@@@@@@@@@@@@@@@@@@@@@@@@@@n",t),t.cobrar==="COBRAR")e+=parseFloat(t.valor);else if(t.cobrar==="DEVOLVER"){const o=e-parseFloat(t.valor);o>=0?e=o:alert("Alerta: Valor inválido encontrado (o valor devolvido não pode ser superior ao cobtrado).")}}),this.lotes.valor=e},onInput(){this.sumCheckedValues()},filterTable(){this.filteredReceita=this.receitas.filter(a=>this.headers.every(e=>{if(e.search.trim()==="")return!0;const t=String(a[e.value]).toLowerCase(),o=e.search.toLowerCase();return t.includes(o)}))},filterOnEnter(){console.log("Enter pressionado"),this.filterTable()},filterOnBlur(){console.log("Campo perdeu o foco"),this.filterTable()}},mounted(){this.userData=JSON.parse(localStorage.getItem("user")),this.loadLotes()}},$=Object.assign(H,{__name:"GerarTitulosHome",setup(a){return(e,t)=>(c(),g(V,null,[s(S),s(k,{class:"mt-6","no-gutters":""},{default:l(()=>[s(i,{class:"ml-2"},{default:l(()=>[s(L,{modelValue:e.selectedItem,"onUpdate:modelValue":t[0]||(t[0]=o=>e.selectedItem=o),items:e.lotesCombo,label:"Selecione um lote","item-title":"nome","item-value":"token"},null,8,["modelValue","items"])]),_:1}),d("div",null,[s(i,{class:"btn-pointer",onClick:t[1]||(t[1]=o=>e.gerarReceitas(e.selectedItem))},{default:l(()=>[D]),_:1})]),s(i,null,{default:l(()=>[s(u,{class:"ml-6",modelValue:e.lotes.data_vencimento,"onUpdate:modelValue":t[2]||(t[2]=o=>e.lotes.data_vencimento=o),type:"date",label:"Data de vencimento"},null,8,["modelValue"])]),_:1}),s(i,{class:"ml-5"},{default:l(()=>[s(u,{modelValue:e.lotes.valor,"onUpdate:modelValue":t[3]||(t[3]=o=>e.lotes.valor=o),type:"number",label:"Valor total",readonly:"",disabled:"",class:"opacity-75"},null,8,["modelValue"])]),_:1}),d("div",null,[s(i,{class:b(["btn-pointer",{disabled:e.valorTotal<=0}]),onClick:t[4]||(t[4]=o=>e.gerarBoletos())},{default:l(()=>[N]),_:1},8,["class"])])]),_:1}),s(u,{modelValue:e.lotes.observacao,"onUpdate:modelValue":t[5]||(t[5]=o=>e.lotes.observacao=o),type:"text",label:"Observação"},null,8,["modelValue"]),s(k,{class:"ml-10 mr-10"},{default:l(()=>[(c(!0),g(V,null,T(e.headers,(o,r)=>(c(),_(i,{key:o.key},{default:l(()=>[r<e.headers.length?(c(),_(u,{key:0,modelValue:o.search,"onUpdate:modelValue":n=>o.search=n,label:o.title,"prepend-inner-icon":"mdi-magnify",outlined:"","hide-details":"","single-line":"",onKeydown:I(e.filterOnEnter,["enter"]),onBlur:e.filterOnBlur,ref_for:!0,ref:"searchFields",class:b("custom-text-field custom-text-field-"+r)},null,8,["modelValue","onUpdate:modelValue","label","onKeydown","onBlur","class"])):U("",!0)]),_:2},1024))),128))]),_:1}),d("div",O,[s(w(A),{headers:e.headers,items:e.filteredReceita,modelValue:e.selected,"onUpdate:modelValue":t[6]||(t[6]=o=>e.selected=o),"rows-per-page-items":e.itemsPerPage,"footer-props":e.footerProps,"show-select":"",density:"default","item-value":"id","item-selectable":"selectable",onChange:e.sumCheckedValues,fixed:""},null,8,["headers","items","modelValue","rows-per-page-items","footer-props","onChange"])])],64))}}),G=E($,[["__scopeId","data-v-b0267a58"]]),Y={__name:"GerarTitulosHome",setup(a){return(e,t)=>(c(),_(G))}};export{Y as default};
