import{_ as f,o as a,d as l,t as V,f as h,c,w as m,F as A,v as R,l as k,x as U,i as p,n as d,a1 as v,j as N,h as T,e as y}from"./index-88a5129e.js";import{A as E}from"./AppBar-f0429b7c.js";import{V as _}from"./VAutocomplete-6839ad36.js";import{V as S}from"./VContainer-2697f82e.js";import{V as L}from"./VCol-888c2a5e.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./VSpacer-49a1f52c.js";import"./layout-44c14d18.js";const I={key:1},b={key:1},B=T("h1",null,"Seleções:",-1),O={data:()=>({userData:{},relatoriosLocalStorage:[],selectedRelatorio:null,loading:!0,parametrosArray:[],relatorioLink:[],comboSelecao:[],previousSelectedRelatorio:null}),created(){this.combolistRelatorios()},methods:{async onChangeSelectedRelatorio(){try{this.selectedRelatorio!==this.previousSelectedRelatorio&&(await this.montarPainelFiltros(),this.previousSelectedRelatorio=this.selectedRelatorio)}catch(o){console.error("Erro ao mudar relatório selecionado:",o)}finally{this.loading=!1}},async combolistRelatorios(){try{this.$store.dispatch("listarRelatorios");const o=localStorage.getItem("relatorio"),t=JSON.parse(o);this.relatoriosLocalStorage=t}catch(o){console.error("Erro ao listar relatórios:",o)}finally{this.loading=!1}},async montarPainelFiltros(){try{const o=this.relatoriosLocalStorage.find(t=>t.codigo===this.selectedRelatorio);if(o){this.parametrosArray=[...o.parametros],this.parametrosArray.forEach(i=>{i.valor=""});const t=JSON.parse(localStorage.getItem("user")),s=JSON.parse(localStorage.getItem("predio")),u={prédioToken:s.predio_token,prédioId:s.predio_id,userToken:t.token,userId:t.id,parametros:o.parametros},e={Authorization:`Bearer ${this.userData.token}`},n=await y.post("http://localhost:3333/service/gerencia/relatorios_query",u,{headers:e});this.comboSelecao=n.data}else this.parametrosArray=[]}catch(o){console.error("Erro ao montar painel de filtros:",o)}finally{this.loading=!1}},async gerarRelatorios(){const o=this.relatoriosLocalStorage.find(i=>i.codigo===this.selectedRelatorio),t=JSON.parse(localStorage.getItem("predio")).predio_token,s=JSON.parse(localStorage.getItem("user")).token;JSON.parse(JSON.stringify(o.parametros)).forEach(i=>{o.parametros_url.predio_token==="p_predio_token"&&(o.parametros_url.predio_token=t),o.parametros_url.usuario_token==="p_usuario_token"&&(o.parametros_url.usuario_token=s),o.parametros_url[i.parametro]=i.valor}),console.log(o.parametros_url);const e={Authorization:`Bearer ${this.userData.token}`},n=await y.post("http://localhost:3333/service/gerencia/gerar_url",o.parametros_url,{headers:e});this.relatorioLink=n.data,window.open(this.relatorioLink,"_blank")}},mounted(){this.userData=JSON.parse(localStorage.getItem("user"))}},P=Object.assign(O,{__name:"relatorios",setup(o){return(t,s)=>{const u=f("mask");return t.loading?(a(),l(V,{key:0,class:"loading-spinner",indeterminate:"",size:"64"})):(a(),h("div",I,[c(E),c(S,null,{default:m(()=>[c(_,{label:"Selecione o Relatório",items:t.relatoriosLocalStorage,"item-title":"codigo","item-value":"codigo",modelValue:t.selectedRelatorio,"onUpdate:modelValue":s[0]||(s[0]=e=>t.selectedRelatorio=e),"onUpdate:search":s[1]||(s[1]=e=>t.montarPainelFiltros()),variant:"outlined"},null,8,["items","modelValue"]),t.loading?(a(),l(V,{key:0,class:"loading-spinner",indeterminate:"",size:"64"})):(a(),h("div",b,[t.parametrosArray.length>0?(a(),l(S,{key:0},{default:m(()=>[B,(a(!0),h(A,null,R(t.parametrosArray,(e,n)=>(a(),l(L,{key:n,cols:"12",md:"6"},{default:m(()=>{var i,g;return[k(U(e.label)+" ",1),e.tipo==="DATE"?(a(),l(p,{key:0,modelValue:e.valor,"onUpdate:modelValue":r=>e.valor=r,type:"date",outlined:""},null,8,["modelValue","onUpdate:modelValue"])):d("",!0),e.tipo==="INTEGER"?v((a(),l(p,{key:1,modelValue:e.valor,"onUpdate:modelValue":r=>e.valor=r,type:"number",outlined:""},null,8,["modelValue","onUpdate:modelValue"])),[[u,"####"]]):d("",!0),e.tipo==="NUMERIC"?v((a(),l(p,{key:2,modelValue:e.valor,"onUpdate:modelValue":r=>e.valor=r,type:"number",outlined:""},null,8,["modelValue","onUpdate:modelValue"])),[[u,"###.##"]]):d("",!0),e.tipo==="TEXT"?(a(),l(p,{key:3,modelValue:e.valor,"onUpdate:modelValue":r=>e.valor=r,outlined:""},null,8,["modelValue","onUpdate:modelValue"])):d("",!0),e.tipo==="ARRAY"?(a(),l(_,{key:4,items:JSON.parse(e.dominio),"item-title":"chave","item-value":"valor",modelValue:e.valor,"onUpdate:modelValue":r=>e.valor=r,outlined:""},null,8,["items","modelValue","onUpdate:modelValue"])):d("",!0),e.tipo==="TABLE"&&((i=t.comboSelecao[n])==null?void 0:i.tipo)==="TABLE"?(a(),l(_,{key:n,items:(g=t.comboSelecao[n])==null?void 0:g.resultado[0].func_json_consulta,label:"Selecione o item","item-title":"chave","item-value":"valor",modelValue:e.valor,"onUpdate:modelValue":r=>e.valor=r,outlined:""},null,8,["items","modelValue","onUpdate:modelValue"])):d("",!0)]}),_:2},1024))),128)),c(N,{class:"me-4",color:"red",onClick:t.gerarRelatorios},{default:m(()=>[k(" Gerar Relatorio ")]),_:1},8,["onClick"])]),_:1})):d("",!0)]))]),_:1})]))}}}),G={__name:"Relatorios",setup(o){return(t,s)=>(a(),l(P))}};export{G as default};
